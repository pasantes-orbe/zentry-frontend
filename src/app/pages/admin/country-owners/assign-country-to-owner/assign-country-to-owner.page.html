<app-navbar-back title="Asignar Propiedad a Propietario"></app-navbar-back>

<ion-content [fullscreen]="true">
  <div class="page-container">
    <form class="form-container" [formGroup]="form" (ngSubmit)="asignarPropiedadAlUsuario()">

      <div class="form-header">
        <ion-icon name="swap-horizontal-outline"></ion-icon>
        <h3>Asignación de Propiedades</h3>
      </div>

      <div class="assignment-grid">

        <!-- Propietarios -->
        <div class="selection-panel">
          <div class="panel-header"><h4>Paso 1: Seleccionar Propietario</h4></div>

          <ion-searchbar mode="ios" placeholder="Buscar propietario..." (ionInput)="onSearchOwners($event)"></ion-searchbar>

          <ion-list class="selection-list">
            <ion-radio-group formControlName="user_id">
              <ion-item *ngFor="let owner of filteredOwners; trackBy: trackOwner"
                        class="selection-item"
                        [disabled]="ownerId(owner) === null">
                <ion-avatar slot="start">
                  <img [src]="ownerAvatar(owner)" />
                </ion-avatar>
                <ion-label>
                  <h2>{{ ownerName(owner) }} {{ ownerLastname(owner) }}</h2>
                  <p>DNI: {{ ownerDni(owner) }}</p>
                </ion-label>
                <ion-radio slot="end" [value]="ownerId(owner)"></ion-radio>
              </ion-item>
            </ion-radio-group>
          </ion-list>
        </div>

        <!-- Propiedades -->
        <div class="selection-panel" [class.is-disabled]="!form.get('user_id')?.value">
          <div class="panel-header"><h4>Paso 2: Seleccionar Propiedad</h4></div>

          <ion-searchbar mode="ios" placeholder="Buscar propiedad..." (ionInput)="onSearchProperties($event)"></ion-searchbar>

          <ion-list class="selection-list">
            <ion-radio-group formControlName="property_id">
              <ion-item *ngFor="let property of filteredProperties; trackBy: trackProperty"
                        class="selection-item"
                        [disabled]="propertyId(property) === null">
                <ion-avatar slot="start">
                  <img [src]="propertyAvatar(property)" />
                </ion-avatar>
                <ion-label>
                  <h2>{{ propertyName(property) }}</h2>
                  <p>Nº / Lote: {{ propertyNumber(property) }}</p>
                </ion-label>
                <ion-radio slot="end" [value]="propertyId(property)"></ion-radio>
              </ion-item>
            </ion-radio-group>
          </ion-list>
        </div>

      </div>

      <ion-button class="submit-button" type="submit" [disabled]="form.invalid" expand="block">
        <ion-icon slot="start" name="checkmark-done-outline"></ion-icon>
        Asignar Propiedad
      </ion-button>

    </form>
  </div>
</ion-content>
