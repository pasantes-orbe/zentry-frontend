<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start" class="header-brand">
      <img src="assets/logos/logo-48.png" class="header-logo" alt="Zentry Logo" />
      <span class="header-title-text">{{ countryName() }}</span>
    </ion-buttons>

    <ion-buttons slot="end">
      <!-- Campanita de notificaciones -->
      <ion-button id="notifications-trigger" class="notifications-button">
        <ion-icon name="notifications-outline"></ion-icon>
        <ion-badge *ngIf="unreadCount > 0" class="notif-badge">{{ unreadCount }}</ion-badge>
      </ion-button>

      <!-- Menú de usuario -->
      <ion-button id="user-menu-trigger" class="user-menu-button">
        <ion-avatar>
          <img src="https://ionicframework.com/docs/img/demos/avatar.svg" alt="User Avatar"/>
        </ion-avatar>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<!-- Popover de notificaciones -->
<ion-popover trigger="notifications-trigger" triggerAction="click" [dismissOnSelect]="false" class="notifications-popover">
  <ng-template>
    <app-notifications-popover [notifications]="notifications"></app-notifications-popover>
  </ng-template>
</ion-popover>

<!-- Popover de usuario -->
<ion-popover trigger="user-menu-trigger" triggerAction="click" [dismissOnSelect]="true" class="user-menu-popover">
  <ng-template>
    <ion-content>
      <ion-list lines="full">
        <ion-item class="popover-item">
          <ion-icon name="moon-outline" slot="start"></ion-icon>
          <ion-label>Modo Oscuro</ion-label>
          <ion-toggle
            slot="end"
            [checked]="theme.isDark()"
            (ionChange)="onThemeToggle($event)">
          </ion-toggle>
        </ion-item>

        <ion-item class="popover-item" (click)="backToAdminHome()" button="true" detail="false">
          <ion-icon name="home-outline" slot="start" color="primary"></ion-icon>
          <ion-label>Volver a Admin Home</ion-label>
        </ion-item>

        <ion-item class="popover-item" (click)="logout()" button="true" detail="false">
          <ion-icon name="log-out-outline" slot="start" color="danger"></ion-icon>
          <ion-label color="danger">Cerrar Sesión</ion-label>
        </ion-item>
      </ion-list>
    </ion-content>
  </ng-template>
</ion-popover>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">{{ countryName() }}</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="hero" *ngIf="!loading">
    <ion-img [src]="getCountryImage()"></ion-img>
    <div class="hero-overlay">
      <h2>{{ country?.name }}</h2>
      <p *ngIf="country">Lat: {{ country.latitude }} · Lng: {{ country.longitude }}</p>
    </div>
  </div>

  <div class="state" *ngIf="loading">
    <ion-spinner name="crescent"></ion-spinner>
  </div>
  <div class="state" *ngIf="!loading && !country">
    <p>No se encontró el country. Volvé a <a (click)="backToAdminHome()">Admin Home</a>.</p>
  </div>

  <ng-container *ngIf="!loading && country">
    <ion-segment [(ngModel)]="type" mode="ios" [swipeGesture]="true" class="dashboard-segment">
      <ion-segment-button value="propiedades" checked>
        <ion-label>Propiedades</ion-label>
      </ion-segment-button>
      <ion-segment-button value="vigiladores">
        <ion-label>Vigiladores</ion-label>
      </ion-segment-button>
      <ion-segment-button value="eventos">
        <ion-label>Eventos</ion-label>
      </ion-segment-button>
    </ion-segment>

    <div *ngIf="type === 'propiedades'" class="cards-grid">
      <ion-card class="dash-card" (click)="goToViewProperties()">
        <ion-card-header>
          <ion-icon name="home-outline"></ion-icon>
          <ion-card-title>Ver Propiedades</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>Listado de propiedades del country.</p>
          <ion-button fill="clear" expand="block">ABRIR</ion-button>
        </ion-card-content>
      </ion-card>

      <ion-card class="dash-card" (click)="goToViewOwners()">
        <ion-card-header>
          <ion-icon name="people-outline"></ion-icon>
          <ion-card-title>Ver Propietarios</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>Listado de propietarios asignados.</p>
          <ion-button fill="clear" expand="block">ABRIR</ion-button>
        </ion-card-content>
      </ion-card>

      <ion-card class="dash-card" (click)="goToRecurrents()">
        <ion-card-header>
          <ion-icon name="repeat-outline"></ion-icon>
          <ion-card-title>Invitados Recurrentes</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>Gestioná recurrentes del country.</p>
          <ion-button fill="clear" expand="block">ABRIR</ion-button>
        </ion-card-content>
      </ion-card>

      <ion-card class="dash-card" (click)="goToAddProperty()">
        <ion-card-header>
          <ion-icon name="add-circle-outline"></ion-icon>
          <ion-card-title>Añadir Propiedad</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>Cargar nueva propiedad al country.</p>
          <ion-button fill="clear" expand="block">CREAR</ion-button>
        </ion-card-content>
      </ion-card>

      <ion-card class="dash-card" (click)="goToAddOwner()">
        <ion-card-header>
          <ion-icon name="person-add-outline"></ion-icon>
          <ion-card-title>Añadir Propietario</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>Dar de alta un nuevo propietario para este country.</p>
          <ion-button fill="clear" expand="block">AÑADIR</ion-button>
        </ion-card-content>
      </ion-card>

      <ion-card class="dash-card" (click)="goToAssignCountryToOwner()">
        <ion-card-header>
          <ion-icon name="link-outline"></ion-icon>
          <ion-card-title>Asignar Country a Propietario</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>Vincular un propietario existente a este country.</p>
          <ion-button fill="clear" expand="block">ASIGNAR</ion-button>
        </ion-card-content>
      </ion-card>
    </div>

    <div *ngIf="type === 'vigiladores'" class="cards-grid">
      <ion-card class="dash-card" (click)="goToAllGuards()">
        <ion-card-header>
          <ion-icon name="shield-outline"></ion-icon>
          <ion-card-title>Todos los Vigiladores</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>Listado general del personal de seguridad.</p>
          <ion-button fill="clear" expand="block">ABRIR</ion-button>
        </ion-card-content>
      </ion-card>

      <ion-card class="dash-card" (click)="goToCheckInOutHistorial()">
        <ion-card-header>
          <ion-icon name="swap-vertical-outline"></ion-icon>
          <ion-card-title>Historial CheckIn/Out</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>Registros de entradas y salidas.</p>
          <ion-button fill="clear" expand="block">VER HISTORIAL</ion-button>
        </ion-card-content>
      </ion-card>

      <ion-card class="dash-card" (click)="goToAntipanicHistorial()">
        <ion-card-header>
          <ion-icon name="alert-circle-outline"></ion-icon>
          <ion-card-title>Historial Antipánico</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>Eventos del botón antipánico.</p>
          <ion-button fill="clear" expand="block">VER HISTORIAL</ion-button>
        </ion-card-content>
      </ion-card>

      <ion-card class="dash-card" (click)="goToMapGuards()">
        <ion-card-header>
          <ion-icon name="map-outline"></ion-icon>
          <ion-card-title>Mapa de Vigiladores</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>Ubicación en vivo de vigiladores.</p>
          <ion-button fill="clear" expand="block">ABRIR MAPA</ion-button>
        </ion-card-content>
      </ion-card>

      <ion-card class="dash-card" (click)="goToAddGuard()">
        <ion-card-header>
          <ion-icon name="person-add-outline"></ion-icon>
          <ion-card-title>Añadir Vigilador</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>Dar de alta un nuevo vigilador para este country.</p>
          <ion-button fill="clear" expand="block">AÑADIR</ion-button>
        </ion-card-content>
      </ion-card>
    </div>

    

    <div *ngIf="type === 'eventos'" class="cards-grid">
      <ion-card class="dash-card" (click)="goToAmenities()">
        <ion-card-header>
          <ion-icon name="fitness-outline"></ion-icon>
          <ion-card-title>Amenidades</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>Ver/gestionar amenities del country.</p>
          <ion-button fill="clear" expand="block">ABRIR</ion-button>
        </ion-card-content>
      </ion-card>

      <ion-card class="dash-card" (click)="goToEventsHistorial()">
        <ion-card-header>
          <ion-icon name="time-outline"></ion-icon>
          <ion-card-title>Historial de Eventos</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>Registro de eventos generales.</p>
          <ion-button fill="clear" expand="block">VER HISTORIAL</ion-button>
        </ion-card-content>
      </ion-card>
    </div>
  </ng-container>
</ion-content>
